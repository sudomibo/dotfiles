#!/usr/bin/env bash

set -uo pipefail

declare -a PREREQS=("vim" "grep" "cut")
for prereq in "${PREREQS[@]}"; do
	if ! hash "$prereq" 2>/dev/null; then
		echo "[!] $prereq not found but required" >&2
		exit 1
	fi
done
cmds="syntax on|set number!|normal zt"
case $# in
1)
	if [ -f "$1" ]; then
		vim -R "$1" -c '"$cmds"'
	else
		echo "[!] $1 not found or not a file" >&2
		exit 2
	fi
;;
2)
	if [ -f "$1" ]; then
		if [[ "$2" =~ ^[0-9]{1,}$ ]]; then
			vim -R "$1" +"$2" -c '"$cmds"'
		else
			location=$(grep -m 1 -n "$2" $1)
			if [ "$?" -eq 0 ]; then
				location=$(echo -n "$location" | cut -d':' -f1)
				vim -R "$1" +"$location" -c '"$cmds"'
			else
				vim -R "$1" -c '"$cmds"'
			fi
		fi
	else
		echo "[!] $1 not found or not a file" >&2
		exit 3
	fi
;;
*)
	exit 4
;;
esac

